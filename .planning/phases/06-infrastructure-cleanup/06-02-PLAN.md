---
phase: 06-infrastructure-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - esxi/portgroup_functions.go
  - esxi/portgroup_create.go
  - esxi/portgroup_delete.go
  - esxi/portgroup_update.go
  - esxi/vswitch_functions.go
  - esxi/vswitch_create.go
  - esxi/vswitch_delete.go
  - esxi/resource-pool_functions.go
  - esxi/resource-pool_create.go
  - esxi/resource-pool_update.go
  - esxi/resource-pool_delete.go
  - esxi/virtual-disk_functions.go
  - esxi/virtual-disk_delete.go
  - esxi/data_source_esxi_virtual_disk.go
  - esxi/guest_functions.go
  - esxi/guest-read.go
  - esxi/guest_device_info.go
  - esxi/data_source_esxi_guest.go
  - esxi/portgroup_functions_test.go
  - esxi/vswitch_functions_test.go
  - esxi/resource-pool_functions_test.go
  - esxi/virtual-disk_functions_test.go
  - esxi/guest_device_info_test.go
autonomous: true

must_haves:
  truths:
    - "No function definitions with _govmomi suffix exist in the codebase"
    - "No wrapper functions exist that only delegate to another function"
    - "All callers updated to use the new function names"
    - "All log.Printf statements use the renamed function names (no _govmomi in log strings)"
    - "Provider builds and all tests pass after rename"
  artifacts:
    - path: "esxi/portgroup_functions.go"
      provides: "portgroupCreate, portgroupDelete, portgroupRead, portgroupSecurityPolicyRead, portgroupUpdate as direct implementations (no wrappers, no _govmomi suffix)"
    - path: "esxi/vswitch_functions.go"
      provides: "vswitchCreate, vswitchDelete, vswitchRead, vswitchUpdate as direct implementations"
    - path: "esxi/resource-pool_functions.go"
      provides: "getPoolID, getPoolNAME, resourcePoolRead, resourcePoolCreate, resourcePoolUpdate, resourcePoolDelete as direct implementations"
    - path: "esxi/virtual-disk_functions.go"
      provides: "diskStoreValidate, virtualDiskCREATE, virtualDiskREAD, growVirtualDisk, virtualDiskDelete as direct implementations"
    - path: "esxi/guest_functions.go"
      provides: "guestGetVMID_govmomi, guestValidateVMID_govmomi and power functions renamed without suffix"
    - path: "esxi/guest-read.go"
      provides: "guestREAD_govmomi renamed without suffix"
    - path: "esxi/guest_device_info.go"
      provides: "guestReadDevices_govmomi renamed without suffix"
    - path: "esxi/data_source_esxi_virtual_disk.go"
      provides: "findVirtualDiskInDir_govmomi renamed without suffix"
  key_links:
    - from: "esxi/portgroup_create.go"
      to: "esxi/portgroup_functions.go"
      via: "portgroupCreate (direct call, no wrapper)"
      pattern: "portgroupCreate\\("
    - from: "esxi/resource-pool_create.go"
      to: "esxi/resource-pool_functions.go"
      via: "resourcePoolCreate (direct call, no wrapper)"
      pattern: "resourcePoolCreate\\("
    - from: "esxi/data_source_esxi_guest.go"
      to: "esxi/guest_device_info.go"
      via: "guestReadDevices (no _govmomi suffix)"
      pattern: "guestReadDevices\\("
---

<objective>
Rename all _govmomi suffixed functions to their final names and inline wrapper functions. After this plan, no function has a _govmomi suffix and no wrapper-only functions exist.

Purpose: Completes the architecture cleanup by removing migration-era naming artifacts. The _govmomi suffix was kept during phases 2-5 to avoid premature renaming. Now that all SSH removal is complete and the useGovmomi flag is gone (Plan 01), govmomi IS the implementation -- the suffix is misleading.
Output: Clean function names throughout the codebase, no wrappers, no _govmomi suffixes.
</objective>

<execution_context>
@/home/cars/.claude/get-shit-done/workflows/execute-plan.md
@/home/cars/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-infrastructure-cleanup/06-RESEARCH.md
@.planning/phases/06-infrastructure-cleanup/06-01-SUMMARY.md
@esxi/portgroup_functions.go
@esxi/vswitch_functions.go
@esxi/resource-pool_functions.go
@esxi/virtual-disk_functions.go
@esxi/guest_functions.go
@esxi/guest-read.go
@esxi/guest_device_info.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Inline wrappers and rename _govmomi in portgroup, vswitch, resource_pool, virtual_disk</name>
  <files>
    esxi/portgroup_functions.go
    esxi/portgroup_create.go
    esxi/portgroup_delete.go
    esxi/portgroup_update.go
    esxi/vswitch_functions.go
    esxi/vswitch_create.go
    esxi/vswitch_delete.go
    esxi/resource-pool_functions.go
    esxi/resource-pool_create.go
    esxi/resource-pool_update.go
    esxi/resource-pool_delete.go
    esxi/virtual-disk_functions.go
    esxi/virtual-disk_delete.go
    esxi/data_source_esxi_virtual_disk.go
    esxi/portgroup_functions_test.go
    esxi/vswitch_functions_test.go
    esxi/resource-pool_functions_test.go
    esxi/virtual-disk_functions_test.go
  </files>
  <action>
    For each resource, perform these steps in order. Build after each resource to catch errors early.

    **Strategy:** For wrapper+implementation pairs (e.g., portgroupRead wrapper calls portgroupRead_govmomi), delete the wrapper function and rename the _govmomi function to the wrapper's name. For CRUD callers that directly call _govmomi functions (e.g., portgroup_create.go calls portgroupCreate_govmomi), update the call to the new name.

    **PORTGROUP (esxi/portgroup_functions.go + callers):**
    Rename these 5 functions by removing `_govmomi` suffix:
    - `portgroupCreate_govmomi` -> `portgroupCreate` (delete existing portgroupCreate wrapper if one exists in create file, but portgroup_create.go calls _govmomi directly -- just rename)
    - `portgroupDelete_govmomi` -> `portgroupDelete`
    - `portgroupRead_govmomi` -> `portgroupRead` (delete the thin wrapper `portgroupRead` at top of file, rename _govmomi to portgroupRead)
    - `portgroupSecurityPolicyRead_govmomi` -> `portgroupSecurityPolicyRead` (delete thin wrapper, rename _govmomi)
    - `portgroupUpdate_govmomi` -> `portgroupUpdate`

    Update callers in:
    - esxi/portgroup_create.go: `portgroupCreate_govmomi(` -> `portgroupCreate(`
    - esxi/portgroup_delete.go: `portgroupDelete_govmomi(` -> `portgroupDelete(`
    - esxi/portgroup_update.go: `portgroupUpdate_govmomi(` -> `portgroupUpdate(`
    - esxi/portgroup_functions.go: Remove wrapper functions for portgroupRead and portgroupSecurityPolicyRead

    Update log.Printf strings: replace `[portgroupRead_govmomi]` with `[portgroupRead]`, etc.

    Run: `go build ./...` to verify portgroup rename.

    **VSWITCH (esxi/vswitch_functions.go + callers):**
    Rename these 4 functions:
    - `vswitchCreate_govmomi` -> `vswitchCreate`
    - `vswitchDelete_govmomi` -> `vswitchDelete`
    - `vswitchRead_govmomi` -> `vswitchRead` (delete thin wrapper)
    - `vswitchUpdate_govmomi` -> `vswitchUpdate` (delete thin wrapper)

    Update callers in:
    - esxi/vswitch_create.go: `vswitchCreate_govmomi(` -> `vswitchCreate(`
    - esxi/vswitch_delete.go: `vswitchDelete_govmomi(` -> `vswitchDelete(`
    - esxi/vswitch_functions.go: Remove wrapper functions for vswitchUpdate and vswitchRead

    Update log.Printf strings.
    Run: `go build ./...`

    **RESOURCE POOL (esxi/resource-pool_functions.go + callers):**
    Rename these 6 functions:
    - `getPoolID_govmomi` -> `getPoolID` (delete thin wrapper)
    - `getPoolNAME_govmomi` -> `getPoolNAME` (delete thin wrapper)
    - `resourcePoolRead_govmomi` -> `resourcePoolRead` (delete thin wrapper)
    - `resourcePoolCreate_govmomi` -> `resourcePoolCreate`
    - `resourcePoolUpdate_govmomi` -> `resourcePoolUpdate`
    - `resourcePoolDelete_govmomi` -> `resourcePoolDelete`

    Update callers in:
    - esxi/resource-pool_create.go: `resourcePoolCreate_govmomi(` -> `resourcePoolCreate(`
    - esxi/resource-pool_update.go: `resourcePoolUpdate_govmomi(` -> `resourcePoolUpdate(`
    - esxi/resource-pool_delete.go: `resourcePoolDelete_govmomi(` -> `resourcePoolDelete(`
    - esxi/resource-pool_functions.go: Remove wrapper functions for getPoolID, getPoolNAME, resourcePoolRead

    Update log.Printf strings.
    Run: `go build ./...`

    **VIRTUAL DISK (esxi/virtual-disk_functions.go + esxi/data_source_esxi_virtual_disk.go + callers):**
    Rename these 5 functions:
    - `diskStoreValidate_govmomi` -> `diskStoreValidate` (delete thin wrapper)
    - `virtualDiskCREATE_govmomi` -> `virtualDiskCREATE` (delete thin wrapper)
    - `virtualDiskREAD_govmomi` -> `virtualDiskREAD` (delete thin wrapper)
    - `growVirtualDisk_govmomi` -> `growVirtualDisk` (delete thin wrapper)
    - `virtualDiskDelete_govmomi` -> `virtualDiskDelete`
    - `findVirtualDiskInDir_govmomi` -> `findVirtualDiskInDir` (in data_source_esxi_virtual_disk.go)

    Update callers in:
    - esxi/virtual-disk_delete.go: `virtualDiskDelete_govmomi(` -> `virtualDiskDelete(`
    - esxi/virtual-disk_functions.go: Remove wrapper functions for diskStoreValidate, virtualDiskCREATE, virtualDiskREAD, growVirtualDisk
    - esxi/data_source_esxi_virtual_disk.go: Rename function definition and any internal callers

    Update log.Printf strings.
    Run: `go build ./...`

    **TEST FILES:**
    Update any test function names or test code that references _govmomi function names:
    - esxi/portgroup_functions_test.go: Update any direct _govmomi calls
    - esxi/vswitch_functions_test.go: Update any direct _govmomi calls
    - esxi/resource-pool_functions_test.go: Update any direct _govmomi calls
    - esxi/virtual-disk_functions_test.go: Update any direct _govmomi calls
    NOTE: Do NOT rename test function names (e.g., keep TestPortgroupCreateReadDeleteGovmomi as-is per research recommendation -- test names document what API they validate).
  </action>
  <verify>
    Run `grep -rn "func.*_govmomi(" esxi/portgroup_functions.go esxi/vswitch_functions.go esxi/resource-pool_functions.go esxi/virtual-disk_functions.go esxi/data_source_esxi_virtual_disk.go` - should return zero matches.
    Run `go build ./...` - must compile.
    Run `go test ./esxi/ -v -run "TestPortgroup|TestVswitch|TestResourcePool|TestVirtualDisk"` - all resource tests pass.
  </verify>
  <done>All _govmomi functions in portgroup, vswitch, resource_pool, virtual_disk renamed. All wrapper functions deleted and replaced by direct implementations. All callers updated. Build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Rename _govmomi in guest operations and final verification</name>
  <files>
    esxi/guest_functions.go
    esxi/guest-read.go
    esxi/guest_device_info.go
    esxi/data_source_esxi_guest.go
    esxi/guest_device_info_test.go
  </files>
  <action>
    **GUEST FUNCTIONS (esxi/guest_functions.go):**
    Rename these 6 _govmomi functions. These are standalone implementations (not wrappers), called from data sources or tests. After Plan 01 removed the useGovmomi conditionals, the wrapper functions in guest_functions.go (guestGetVMID, guestPowerOn, etc.) now contain only SSH code. The _govmomi variants are separate implementations used by data sources.

    - `guestGetVMID_govmomi` -> `guestGetVMIDGovmomi` (keep as separate function -- data sources need govmomi path while resource operations use SSH)
      WAIT -- reconsider. After Plan 01, guestGetVMID only has SSH. But data_source_esxi_guest.go was using `if c.useGovmomi` to choose between govmomi and SSH. Plan 01 removed that conditional. Let me check what data_source_esxi_guest.go now does.

    Actually, looking more carefully at the research and data_source_esxi_guest.go: the useGovmomi conditional at line 448 is about device info reading, not about guestGetVMID. The data source calls guestREAD (which uses SSH after Plan 01 removes the govmomi branch).

    So the _govmomi guest functions (guestGetVMID_govmomi, guestValidateVMID_govmomi, guestPowerOn_govmomi, guestPowerOff_govmomi, guestPowerGetState_govmomi, guestGetIpAddress_govmomi) are now ORPHANED -- no callers remain after Plan 01 removed the conditionals.

    Verify this first: `grep -rn "guestGetVMID_govmomi\|guestValidateVMID_govmomi\|guestPowerOn_govmomi\|guestPowerOff_govmomi\|guestPowerGetState_govmomi\|guestGetIpAddress_govmomi" esxi/` -- if zero callers found, DELETE these functions entirely (do not rename).

    If callers exist, rename by removing _govmomi suffix and update callers.

    **GUEST READ (esxi/guest-read.go):**
    - `guestREAD_govmomi` -> check if callers exist after Plan 01. If guestREAD now only uses SSH and no one calls guestREAD_govmomi directly, DELETE it. If data sources call it, rename to `guestREADGovmomi` or similar.

    Verify: `grep -rn "guestREAD_govmomi" esxi/` -- if only definition, delete. If callers exist, rename.

    **GUEST DEVICE INFO (esxi/guest_device_info.go):**
    - `guestReadDevices_govmomi` -> `guestReadDevices` (this IS called from data_source_esxi_guest.go unconditionally after Plan 01)
    Update caller in esxi/data_source_esxi_guest.go: `guestReadDevices_govmomi(` -> `guestReadDevices(`
    Update log.Printf strings.

    **DATA SOURCE GUEST (esxi/data_source_esxi_guest.go):**
    - Update call from `guestReadDevices_govmomi` to `guestReadDevices`

    **TEST FILE (esxi/guest_device_info_test.go):**
    - Update any references to `guestReadDevices_govmomi` -> `guestReadDevices`

    **FINAL VERIFICATION:**
    After all renames, run comprehensive check:
    - `grep -rn "_govmomi" esxi/*.go` -- should return ZERO matches in function definitions and calls (comments referencing migration history are acceptable but should be cleaned up)
    - `go build ./...` -- must compile
    - `go test ./esxi/ -v` -- all 27/32 tests must pass

    **IMPORT CLEANUP (INFRA-02):**
    After removing orphaned _govmomi guest functions, check if any imports become unused in guest_functions.go and guest-read.go. The Go compiler will error on unused imports. Fix any import errors.

    Also check data_source_esxi_host.go -- after Plan 01 made it call govmomi directly, the SSH helper functions and their imports may be unused. However, since the SSH functions remain in the file (not deleted), their imports likely remain needed. Only clean imports that the compiler flags.
  </action>
  <verify>
    Run `grep -rn "func.*_govmomi(" esxi/` - should return zero matches (no _govmomi function definitions remain).
    Run `grep -rn "_govmomi" esxi/*.go` - should return zero or near-zero matches (only acceptable in comments about migration history, if any).
    Run `go build ./...` - must compile.
    Run `go test ./esxi/ -v` - 27/32 tests pass (baseline maintained).
  </verify>
  <done>All _govmomi function references eliminated. Orphaned guest _govmomi functions deleted. guestReadDevices renamed. Build succeeds. Test baseline maintained at 27/32 passing. Zero _govmomi references in function definitions or calls across codebase.</done>
</task>

</tasks>

<verification>
1. `grep -rn "func.*_govmomi(" esxi/` returns zero matches - no _govmomi function definitions
2. `grep -rn "_govmomi(" esxi/*.go` returns zero matches - no _govmomi function calls
3. `grep -rn "useGovmomi" esxi/` returns zero matches - flag completely removed (verified in Plan 01)
4. `go build ./...` succeeds - clean compilation
5. `go test ./esxi/ -v` shows 27/32 passing - baseline maintained
6. No wrapper-only functions remain: every function in *_functions.go files contains real implementation logic
7. SSH infrastructure intact: `grep -rn "runRemoteSshCommand" esxi/guest*.go` shows guest operations still use SSH
8. govmomi infrastructure intact: `grep -rn "GetGovmomiClient" esxi/portgroup_functions.go esxi/vswitch_functions.go` shows resources use govmomi
</verification>

<success_criteria>
- Zero _govmomi function definitions in codebase
- Zero _govmomi function calls in codebase
- All wrapper functions inlined (portgroupRead, vswitchRead, vswitchUpdate, getPoolID, getPoolNAME, resourcePoolRead, diskStoreValidate, virtualDiskCREATE, virtualDiskREAD, growVirtualDisk)
- Orphaned guest _govmomi functions deleted
- guestReadDevices_govmomi renamed to guestReadDevices
- findVirtualDiskInDir_govmomi renamed to findVirtualDiskInDir
- All log strings updated (no _govmomi in log output)
- go build ./... succeeds
- go test ./esxi/ -v: 27/32 passing (baseline maintained)
- All unused imports cleaned
</success_criteria>

<output>
After completion, create `.planning/phases/06-infrastructure-cleanup/06-02-SUMMARY.md`
</output>
